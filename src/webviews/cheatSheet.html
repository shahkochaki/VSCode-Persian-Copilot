<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Vazirmatn", "Tahoma", "Arial", sans-serif;
        background-color: var(--vscode-editor-background);
        color: var(--vscode-editor-foreground);
        line-height: 1.6;
        padding: 20px;
        direction: rtl;
        margin: 0;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--vscode-panel-border);
      }

      /* Status Bar */
      .status-bar {
        padding: 15px 0;
        border-bottom: 1px solid var(--vscode-panel-border);
        margin-bottom: 20px;
      }

      .guest-section {
        text-align: center;
      }

      .info-message {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        background: var(--vscode-editor-inactiveSelectionBackground);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 8px;
        padding: 15px 20px;
        color: var(--vscode-foreground);
      }

      .info-message span:first-child {
        font-size: 1.2rem;
      }

      .login-guide-button {
        background: #007acc;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }

      .login-guide-button:hover {
        background: #005a9e;
      }

      .user-section {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
      }

      .auth-button {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.2s;
      }

      .auth-button:hover {
        background: var(--vscode-button-hoverBackground);
      }

      .auth-button.primary {
        background: #007acc;
        color: white;
      }

      .auth-button.primary:hover {
        background: #005a9e;
      }

      #userWelcome {
        color: var(--vscode-foreground);
        font-weight: 500;
        margin-left: 15px;
      }

      /* Search and Filter Section */
      .search-filter-section {
        margin: 20px 0;
        display: flex;
        flex-direction: column;
        gap: 15px;
        align-items: center;
      }

      .search-container {
        display: flex;
        gap: 8px;
        width: 100%;
        max-width: 400px;
      }

      .search-container input {
        flex: 1;
        padding: 10px 15px;
        border: 1px solid var(--vscode-input-border);
        border-radius: 4px;
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        font-size: 0.9rem;
      }

      .search-container input:focus {
        outline: none;
        border-color: #007acc;
      }

      .search-container button {
        background: #007acc;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
      }

      .filter-container {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .filter-container select {
        padding: 8px 12px;
        border: 1px solid var(--vscode-input-border);
        border-radius: 4px;
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        font-size: 0.9rem;
      }

      /* Login/Register Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
      }

      .modal-content {
        background-color: var(--vscode-editor-background);
        border: 1px solid var(--vscode-panel-border);
        margin: 10% auto;
        padding: 30px;
        width: 90%;
        max-width: 400px;
        border-radius: 8px;
        direction: rtl;
      }

      .modal-header {
        text-align: center;
        margin-bottom: 25px;
      }

      .modal-header h2 {
        color: #007acc;
        margin-bottom: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--vscode-foreground);
      }

      .form-group input {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--vscode-input-border);
        border-radius: 4px;
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        font-size: 1rem;
        box-sizing: border-box;
      }

      .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--vscode-input-border);
        border-radius: 4px;
        background: var(--vscode-input-background);
        color: var(--vscode-input-foreground);
        font-size: 1rem;
        box-sizing: border-box;
        font-family: "Vazirmatn", "Tahoma", "Arial", sans-serif;
        resize: vertical;
        min-height: 80px;
      }

      .form-group input:focus {
        outline: none;
        border-color: #007acc;
      }

      .modal-actions {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 25px;
      }

      .modal-actions button {
        padding: 12px 25px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        min-width: 100px;
      }

      .btn-primary {
        background: #007acc;
        color: white;
      }

      .btn-primary:hover {
        background: #005a9e;
      }

      .btn-secondary {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
      }

      .btn-secondary:hover {
        background: var(--vscode-button-hoverBackground);
      }

      .error-message {
        color: #f14c4c;
        font-size: 0.9rem;
        margin-top: 10px;
        text-align: center;
      }

      .success-message {
        color: #28a745;
        font-size: 0.9rem;
        margin-top: 10px;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        font-weight: 600;
        color: #007acc;
        margin-bottom: 10px;
      }

      .header p {
        color: var(--vscode-descriptionForeground);
        font-size: 1.1rem;
      }

      .loading,
      .error {
        text-align: center;
        padding: 60px 20px;
        font-size: 1.1rem;
      }

      .loading {
        color: var(--vscode-descriptionForeground);
      }

      .error {
        color: #dc3545;
      }

      .retry-button {
        background: #007acc;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 15px;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .retry-button:hover {
        background: #005a9e;
      }

      .back-button {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 20px;
        font-size: 14px;
        transition: all 0.2s;
      }

      .back-button:hover {
        background: var(--vscode-button-hoverBackground);
      }

      .cheat-sheet-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 16px;
        margin-bottom: 30px;
      }

      .cheat-sheet-card {
        background: var(--vscode-editor-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 6px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
      }

      .cheat-sheet-card:hover {
        background: var(--vscode-list-hoverBackground);
        border-color: var(--vscode-focusBorder);
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
      }

      .card-title {
        font-size: 1rem;
        font-weight: 600;
        margin: 0;
        color: var(--vscode-textPreformat-foreground);
        line-height: 1.3;
        flex: 1;
        margin-right: 8px;
      }

      .card-description {
        color: var(--vscode-descriptionForeground);
        margin-bottom: 12px;
        font-size: 0.85rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .card-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 12px;
        font-size: 0.8rem;
        gap: 8px;
      }

      .card-category {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.75rem;
        font-weight: 500;
        white-space: nowrap;
      }

      .card-count {
        color: var(--vscode-descriptionForeground);
        font-size: 0.75rem;
      }

      .card-author {
        color: var(--vscode-descriptionForeground);
        font-size: 0.75rem;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
      }

      .badge {
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 0.7rem;
        font-weight: 500;
        white-space: nowrap;
      }

      .badge.public {
        background: var(--vscode-charts-green);
        color: white;
      }

      .badge.private {
        background: var(--vscode-charts-orange);
        color: white;
      }

      .card-actions {
        display: flex;
        gap: 6px;
        margin-top: 12px;
        padding-top: 8px;
        border-top: 1px solid var(--vscode-panel-border);
      }

      .card-actions button {
        flex: 1;
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: background 0.2s;
      }

      .card-actions button:first-child {
        background: var(--vscode-button-background);
        color: var(--vscode-button-foreground);
      }

      .card-actions button:first-child:hover {
        background: var(--vscode-button-hoverBackground);
      }

      .card-actions button:last-child {
        background: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
      }

      .card-actions button:last-child:hover {
        background: var(--vscode-button-secondaryHoverBackground);
      }

      .copy-btn {
        position: absolute;
        top: 8px;
        left: 8px;
        background: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
        border: none;
        border-radius: 4px;
        padding: 4px 6px;
        font-size: 0.7rem;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 1;
      }

      .cheat-sheet-card:hover .copy-btn {
        opacity: 1;
      }

      .copy-btn:hover {
        background: var(--vscode-button-secondaryHoverBackground);
      }
      .cheat-sheet-detail {
        display: none;
      }

      .detail-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid var(--vscode-panel-border);
      }

      .detail-title {
        font-size: 1.8rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--vscode-textPreformat-foreground);
      }

      .detail-description {
        color: var(--vscode-descriptionForeground);
        font-size: 1.1rem;
      }

      .items-container {
        display: grid;
        gap: 12px;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      }

      .item-card {
        background: var(--vscode-editor-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 6px;
        padding: 14px;
        transition: all 0.2s ease;
        position: relative;
      }

      .item-card:hover {
        border-color: var(--vscode-focusBorder);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);
      }

      .item-card .copy-btn {
        position: absolute;
        top: 8px;
        left: 8px;
        background: var(--vscode-button-secondaryBackground);
        color: var(--vscode-button-secondaryForeground);
        border: none;
        border-radius: 3px;
        padding: 3px 5px;
        font-size: 0.7rem;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.2s;
        z-index: 1;
      }

      .item-card:hover .copy-btn {
        opacity: 1;
      }

      .item-card .copy-btn:hover {
        background: var(--vscode-button-secondaryHoverBackground);
      }

      .item-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--vscode-textPreformat-foreground);
        line-height: 1.3;
      }

      .item-content {
        color: var(--vscode-descriptionForeground);
        margin-bottom: 12px;
        line-height: 1.5;
        font-size: 0.85rem;
      }

      .code-block {
        position: relative;
        background: var(--vscode-textCodeBlock-background);
        border: 1px solid var(--vscode-panel-border);
        border-radius: 4px;
        padding: 12px;
        font-family: "Courier New", monospace;
        font-size: 0.8rem;
        color: var(--vscode-textPreformat-foreground);
        direction: ltr;
        text-align: left;
        overflow-x: auto;
      }

      .code-block pre {
        margin: 0;
        white-space: pre-wrap;
        word-break: break-all;
      }

      .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--vscode-descriptionForeground);
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 15px;
        opacity: 0.5;
      }

      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .cheat-sheet-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .header h1 {
          font-size: 1.6rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- User Status Bar -->
      <div id="statusBar" class="status-bar">
        <div id="guestSection" class="guest-section">
          <div class="info-message">
            <span>ğŸ’¡</span>
            <span
              >Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ù…Ø¯ÛŒØ±ÛŒØª Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒØŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø®ÙˆØ¯
              Ø´ÙˆÛŒØ¯</span
            >
            <button id="goToLoginBtn" class="login-guide-button">
              Ø±ÙØªÙ† Ø¨Ù‡ ØµÙØ­Ù‡ ÙˆØ±ÙˆØ¯
            </button>
          </div>
        </div>
        <div id="userSection" class="user-section" style="display: none">
          <span id="userWelcome"></span>
          <button id="createNewBtn" class="auth-button primary">
            Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØª Ø´ÛŒØª Ø¬Ø¯ÛŒØ¯
          </button>
        </div>
      </div>

      <div class="header">
        <h1>ğŸ“š Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§</h1>
        <p id="headerDescription">
          Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø§Ø² Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…ÙÛŒØ¯ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡â€ŒØ¯Ù‡Ù†Ø¯Ú¯Ø§Ù†
        </p>

        <!-- Search and Filter Section -->
        <div class="search-filter-section">
          <div class="search-container">
            <input
              type="text"
              id="searchInput"
              placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§..."
            />
            <button id="searchBtn">ğŸ”</button>
          </div>
          <div class="filter-container">
            <select id="categoryFilter">
              <option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</option>
            </select>
            <select id="typeFilter">
              <option value="all">Ù‡Ù…Ù‡ Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§</option>
              <option value="public">Ø¹Ù…ÙˆÙ…ÛŒ</option>
              <option value="my" id="myFilter" style="display: none">
                Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ù†
              </option>
            </select>
          </div>
        </div>
      </div>

      <div id="loadingSection" class="loading">
        <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§...</div>
      </div>

      <div id="errorSection" class="error" style="display: none">
        <div>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§</div>
        <div id="errorMessage"></div>
        <button class="retry-button" onclick="loadCheatSheets()">
          ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯
        </button>
      </div>

      <div id="cheatSheetsSection" style="display: none">
        <div id="cheatSheetsGrid" class="cheat-sheet-grid">
          <!-- Cheat sheets will be populated here -->
        </div>
      </div>

      <div id="cheatSheetDetail" class="cheat-sheet-detail">
        <button class="back-button" onclick="showCheatSheetsList()">
          â† Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª
        </button>
        <div class="detail-header">
          <div id="detailTitle" class="detail-title"></div>
          <div id="detailDescription" class="detail-description"></div>
          <div id="detailOwner" class="detail-owner"></div>
        </div>
        <div id="itemsContainer" class="items-container">
          <!-- Items will be populated here -->
        </div>
      </div>

      <!-- Create/Edit CheatSheet Modal -->
      <div id="cheatSheetModal" class="modal">
        <div class="modal-content" style="max-width: 600px">
          <div class="modal-header">
            <h2 id="cheatSheetModalTitle">Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØª Ø´ÛŒØª Ø¬Ø¯ÛŒØ¯</h2>
          </div>
          <form id="cheatSheetForm">
            <div class="form-group">
              <label for="cheatSheetTitle">Ø¹Ù†ÙˆØ§Ù†:</label>
              <input type="text" id="cheatSheetTitle" required />
            </div>
            <div class="form-group">
              <label for="cheatSheetDescription">ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
              <textarea id="cheatSheetDescription" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label for="cheatSheetCategory">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
              <input type="text" id="cheatSheetCategory" />
            </div>
            <div class="form-group">
              <label>
                <input type="checkbox" id="cheatSheetPublic" />
                Ú†ÛŒØª Ø´ÛŒØª Ø¹Ù…ÙˆÙ…ÛŒ Ø¨Ø§Ø´Ø¯
              </label>
            </div>
            <div
              id="cheatSheetError"
              class="error-message"
              style="display: none"
            ></div>
            <div class="modal-actions">
              <button type="submit" class="btn-primary">Ø°Ø®ÛŒØ±Ù‡</button>
              <button
                type="button"
                class="btn-secondary"
                onclick="closeModal('cheatSheetModal')"
              >
                Ø§Ù†ØµØ±Ø§Ù
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      // VS Code API Integration
      const vscode = acquireVsCodeApi();
      let currentUser = null;

      // Initialize page
      window.addEventListener("load", () => {
        requestUserData();
        loadCheatSheets();
      });

      function requestUserData() {
        vscode.postMessage({
          command: "getUserData",
        });
      }

      function updateUserInterface(userData) {
        currentUser = userData;
        console.log("CheatSheet: Received user data:", userData);

        // Update auth manager with current user data
        if (userData && userData.token) {
          authManager.setUserData(userData);
          cheatSheetService.setAuthToken(userData.token);
          updateAuthUI(true, userData.user);
        } else {
          authManager.clearUserData();
          cheatSheetService.setAuthToken(null);
          updateAuthUI(false, null);
        }

        // Reload cheat sheets to show personal ones if logged in
        loadCheatSheets();
      }

      // Handle messages from extension
      window.addEventListener("message", (event) => {
        const message = event.data;

        switch (message.command) {
          case "setUserData":
            updateUserInterface(message.data);
            break;
        }
      });

      // Import services - Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ Ø§ÛŒÙ† Ú©Ø¯Ù‡Ø§ Ø±Ø§ Ø¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯

      /**
       * Authentication Manager Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ±ÙˆØ¯ Ùˆ Ø®Ø±ÙˆØ¬ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
       */
      class AuthenticationManager {
        constructor() {
          this.baseUrl = "https://console.helpix.app/api/v1"; // Ø¢Ø¯Ø±Ø³ API Ø§ØµÙ„ÛŒ
          this.token = this.getStoredToken();
          this.user = this.getStoredUser();
          this.onAuthStateChangeCallbacks = [];
        }

        setApiUrl(url) {
          this.baseUrl = url;
        }

        getStoredToken() {
          const userData = localStorage.getItem("helpix_user_data");
          if (userData) {
            try {
              const parsedData = JSON.parse(userData);
              return parsedData.token;
            } catch (error) {
              console.error("Error parsing user data:", error);
              return null;
            }
          }
          return null;
        }

        getStoredUser() {
          const userData = localStorage.getItem("helpix_user_data");
          if (userData) {
            try {
              const parsedData = JSON.parse(userData);
              return parsedData.user;
            } catch (error) {
              console.error("Error parsing user data:", error);
              return null;
            }
          }
          return null;
        }

        storeAuthData(token, user) {
          this.token = token;
          this.user = user;

          // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ±Ù…Øª Ù…Ø´Ø§Ø¨Ù‡ login.html
          const userData = {
            token: token,
            user: user,
          };

          localStorage.setItem("helpix_user_data", JSON.stringify(userData));
          this.notifyAuthStateChange(true);
        }

        clearAuthData() {
          this.token = null;
          this.user = null;
          localStorage.removeItem("helpix_user_data");
          this.notifyAuthStateChange(false);
        }

        // New methods for VS Code integration
        setUserData(userData) {
          if (userData && userData.token && userData.user) {
            this.token = userData.token;
            this.user = userData.user;
            this.storeAuthData(userData.token, userData.user);
            this.notifyAuthStateChange(true);
          }
        }

        clearUserData() {
          this.clearAuthData();
        }

        isAuthenticated() {
          return !!this.token && !!this.user;
        }

        getCurrentUser() {
          return this.user;
        }

        getToken() {
          return this.token;
        }

        getAuthHeaders() {
          const headers = {
            "Content-Type": "application/json",
            Accept: "application/json",
          };

          if (this.token) {
            headers["Authorization"] = `Bearer ${this.token}`;
          }

          return headers;
        }

        async makeRequest(url, options = {}) {
          try {
            const response = await fetch(`${this.baseUrl}${url}`, {
              ...options,
              headers: {
                ...this.getAuthHeaders(),
                ...options.headers,
              },
            });

            const data = await response.json();

            if (!response.ok) {
              if (response.status === 401) {
                this.clearAuthData();
              }
              throw new Error(data.message || `Ø®Ø·Ø§: ${response.status}`);
            }

            return data;
          } catch (error) {
            console.error("Authentication Request Error:", error);
            throw error;
          }
        }

        async login(email, password) {
          try {
            const response = await this.makeRequest("/auth/login", {
              method: "POST",
              body: JSON.stringify({ email, password }),
            });

            if (response.success && response.data.token) {
              this.storeAuthData(response.data.token, response.data.user);
              return {
                success: true,
                user: response.data.user,
                message: "Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆØ§Ø±Ø¯ Ø´Ø¯ÛŒØ¯",
              };
            } else {
              throw new Error(response.message || "Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…");
            }
          } catch (error) {
            return {
              success: false,
              message: error.message,
            };
          }
        }

        async register(userData) {
          try {
            const response = await this.makeRequest("/auth/register", {
              method: "POST",
              body: JSON.stringify(userData),
            });

            if (response.success && response.data.token) {
              this.storeAuthData(response.data.token, response.data.user);
              return {
                success: true,
                user: response.data.user,
                message: "Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯",
              };
            } else {
              throw new Error(response.message || "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ");
            }
          } catch (error) {
            return {
              success: false,
              message: error.message,
            };
          }
        }

        async logout() {
          try {
            if (this.token) {
              await this.makeRequest("/auth/logout", {
                method: "POST",
              });
            }
          } catch (error) {
            console.error("Logout error:", error);
          } finally {
            this.clearAuthData();
            return {
              success: true,
              message: "Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯",
            };
          }
        }

        async checkAuthStatus() {
          // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² localStorage Ù…ÙˆØ¬ÙˆØ¯
          const userData = localStorage.getItem("helpix_user_data");
          if (userData) {
            try {
              const parsedData = JSON.parse(userData);
              if (parsedData.token && parsedData.user) {
                this.token = parsedData.token;
                this.user = parsedData.user;
                return true;
              }
            } catch (error) {
              console.error("Error parsing user data:", error);
            }
          }

          this.clearAuthData();
          return false;
        }

        onAuthStateChange(callback) {
          this.onAuthStateChangeCallbacks.push(callback);
        }

        removeAuthStateChangeListener(callback) {
          const index = this.onAuthStateChangeCallbacks.indexOf(callback);
          if (index > -1) {
            this.onAuthStateChangeCallbacks.splice(index, 1);
          }
        }

        notifyAuthStateChange(isAuthenticated) {
          this.onAuthStateChangeCallbacks.forEach((callback) => {
            try {
              callback(isAuthenticated, this.user);
            } catch (error) {
              console.error("Auth state change callback error:", error);
            }
          });
        }
      }

      /**
       * CheatSheet Service Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§
       */
      class CheatSheetService {
        constructor() {
          this.baseUrl = "https://console.helpix.app/api/v1";
          this.token = this.getStoredToken();
        }

        setAuthToken(token) {
          this.token = token;
        }

        getStoredToken() {
          const userData = localStorage.getItem("helpix_user_data");
          if (userData) {
            try {
              const parsedData = JSON.parse(userData);
              return parsedData.token;
            } catch (error) {
              console.error("Error parsing user data:", error);
              return null;
            }
          }
          return null;
        }

        isAuthenticated() {
          return !!this.token;
        }

        getHeaders() {
          const headers = {
            "Content-Type": "application/json",
            Accept: "application/json",
          };

          if (this.token) {
            headers["Authorization"] = `Bearer ${this.token}`;
          }

          return headers;
        }

        async makeRequest(url, options = {}) {
          try {
            const response = await fetch(`${this.baseUrl}${url}`, {
              ...options,
              headers: {
                ...this.getHeaders(),
                ...options.headers,
              },
            });

            const data = await response.json();

            if (!response.ok) {
              throw new Error(data.message || `HTTP Error: ${response.status}`);
            }

            return data;
          } catch (error) {
            console.error("API Request Error:", error);
            throw error;
          }
        }

        async getCheatSheets(params = {}) {
          const queryParams = new URLSearchParams(params).toString();
          const url = queryParams
            ? `/cheat-sheets?${queryParams}`
            : "/cheat-sheets";

          return await this.makeRequest(url);
        }

        async getCheatSheet(id) {
          return await this.makeRequest(`/cheat-sheets/${id}`);
        }

        async createCheatSheet(cheatSheetData) {
          if (!this.isAuthenticated()) {
            throw new Error("Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØª Ø´ÛŒØª Ø´Ø®ØµÛŒ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯");
          }

          return await this.makeRequest("/cheat-sheets", {
            method: "POST",
            body: JSON.stringify(cheatSheetData),
          });
        }

        async updateCheatSheet(id, updateData) {
          if (!this.isAuthenticated()) {
            throw new Error("Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ú†ÛŒØª Ø´ÛŒØª Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯");
          }

          return await this.makeRequest(`/cheat-sheets/${id}`, {
            method: "PUT",
            body: JSON.stringify(updateData),
          });
        }

        async deleteCheatSheet(id) {
          if (!this.isAuthenticated()) {
            throw new Error("Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ú†ÛŒØª Ø´ÛŒØª Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯");
          }

          return await this.makeRequest(`/cheat-sheets/${id}`, {
            method: "DELETE",
          });
        }

        async getMyCheatSheets() {
          if (!this.isAuthenticated()) {
            throw new Error("Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯");
          }

          return await this.getCheatSheets({ owner: "me" });
        }
      }

      // Application Code

      let cheatSheetsData = [];
      let categories = [];
      let currentFilter = "all";
      let currentCategory = "";
      let currentSearch = "";

      // Initialize authentication manager and cheat sheet service
      const authManager = new AuthenticationManager();
      const cheatSheetService = new CheatSheetService();

      // Set API URL (Ø§Ø² Ú©Ø¯ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…)
      const API_BASE_URL = "https://console.helpix.app/api/v1";

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", function () {
        setupEventListeners();
        // loadCheatSheets will be called by updateUserInterface after getting user data
      });

      function setupEventListeners() {
        // Authentication buttons - redirect to main login
        document
          .querySelector(".login-button")
          ?.addEventListener("click", () => {
            vscode.postMessage({
              command: "openTool",
              tool: "login",
            });
          });

        // Also handle the guide button in status bar
        document
          .getElementById("goToLoginBtn")
          ?.addEventListener("click", () => {
            vscode.postMessage({
              command: "openTool",
              tool: "login",
            });
          });

        document.getElementById("logoutBtn")?.addEventListener("click", logout);
        document
          .getElementById("myCheatSheetsBtn")
          ?.addEventListener("click", showMyCheatSheets);
        document
          .getElementById("createNewBtn")
          .addEventListener("click", () => openModal("cheatSheetModal"));

        // Search and filter
        document
          .getElementById("searchBtn")
          .addEventListener("click", performSearch);
        document
          .getElementById("searchInput")
          .addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
              performSearch();
            }
          });
        document
          .getElementById("categoryFilter")
          .addEventListener("change", filterByCategory);
        document
          .getElementById("typeFilter")
          .addEventListener("change", filterByType);

        // Form submissions
        document
          .getElementById("cheatSheetForm")
          .addEventListener("submit", handleCheatSheetSubmit);

        // Auth state change listener
        authManager.onAuthStateChange(onAuthStateChanged);
      }

      function onAuthStateChanged(isAuthenticated, user) {
        updateAuthUI(isAuthenticated, user);

        // Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ ØªÙˆÚ©Ù† Ø¨Ø§ CheatSheetService
        if (isAuthenticated) {
          cheatSheetService.setAuthToken(authManager.getToken());
        } else {
          cheatSheetService.setAuthToken(null);
        }

        loadCheatSheets(); // Reload cheat sheets to show personal ones if logged in
      }

      function updateAuthUI(isAuthenticated, user) {
        const guestSection = document.getElementById("guestSection");
        const userSection = document.getElementById("userSection");
        const myFilter = document.getElementById("myFilter");
        const headerDescription = document.getElementById("headerDescription");

        if (isAuthenticated && user) {
          guestSection.style.display = "none";
          userSection.style.display = "flex";
          if (myFilter) myFilter.style.display = "block";

          // Extract user name from the user data structure
          let userName = "Ú©Ø§Ø±Ø¨Ø±";
          if (user.data && (user.data.firstName || user.data.lastName)) {
            userName = `${user.data.firstName || ""} ${
              user.data.lastName || ""
            }`.trim();
          } else if (user.name) {
            userName = user.name;
          }

          document.getElementById(
            "userWelcome"
          ).textContent = `Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ØŒ ${userName}`;
          headerDescription.textContent =
            "Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø§Ø² Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ø´Ø®ØµÛŒ Ø´Ù…Ø§";
        } else {
          guestSection.style.display = "block";
          userSection.style.display = "none";
          if (myFilter) myFilter.style.display = "none";
          headerDescription.textContent = "Ù…Ø¬Ù…ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø§Ø² Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ";
        }
      }

      async function logout() {
        // Clear local data
        currentUser = null;
        updateUserInterface(null);

        // Open login page to handle logout
        vscode.postMessage({
          command: "openTool",
          tool: "login",
        });

        currentFilter = "all";
        document.getElementById("typeFilter").value = "all";
      }

      async function loadCheatSheets() {
        try {
          showLoading();

          const params = {};

          if (currentSearch) {
            params.search = currentSearch;
          }

          if (currentCategory) {
            params.category = currentCategory;
          }

          let response;

          if (currentFilter === "my" && authManager.isAuthenticated()) {
            response = await cheatSheetService.getMyCheatSheets();
          } else if (currentFilter === "public") {
            // For public only, we'll handle this in the service
            response = await cheatSheetService.getCheatSheets(params);
          } else {
            response = await cheatSheetService.getCheatSheets(params);
          }

          if (response.success && response.data) {
            const data = response.data.data || response.data;
            cheatSheetsData = Array.isArray(data) ? data : [data];
            extractCategories(cheatSheetsData);
            displayCheatSheets(cheatSheetsData);
          } else {
            throw new Error("Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø² Ø³Ø±ÙˆØ±");
          }
        } catch (error) {
          showError(error.message);
          console.error("Error loading cheat sheets:", error);
        }
      }

      function extractCategories(cheatSheets) {
        const categorySet = new Set();
        cheatSheets.forEach((sheet) => {
          if (sheet.category) {
            categorySet.add(sheet.category);
          }
        });

        categories = Array.from(categorySet).sort();
        updateCategoryFilter();
      }

      function updateCategoryFilter() {
        const categoryFilter = document.getElementById("categoryFilter");
        categoryFilter.innerHTML = '<option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</option>';

        categories.forEach((category) => {
          const option = document.createElement("option");
          option.value = category;
          option.textContent = category;
          categoryFilter.appendChild(option);
        });
      }

      function performSearch() {
        currentSearch = document.getElementById("searchInput").value.trim();
        loadCheatSheets();
      }

      function filterByCategory() {
        currentCategory = document.getElementById("categoryFilter").value;
        loadCheatSheets();
      }

      function filterByType() {
        currentFilter = document.getElementById("typeFilter").value;
        loadCheatSheets();
      }

      function showMyCheatSheets() {
        if (!authManager.isAuthenticated()) {
          showMessage("Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú†ÛŒØª Ø´ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯", "error");
          return;
        }

        currentFilter = "my";
        document.getElementById("typeFilter").value = "my";
        loadCheatSheets();
      }

      function showLoading() {
        document.getElementById("loadingSection").style.display = "block";
        document.getElementById("errorSection").style.display = "none";
        document.getElementById("cheatSheetsSection").style.display = "none";
        document.getElementById("cheatSheetDetail").style.display = "none";
      }

      function showError(message) {
        document.getElementById("loadingSection").style.display = "none";
        document.getElementById("errorSection").style.display = "block";
        document.getElementById("cheatSheetsSection").style.display = "none";
        document.getElementById("cheatSheetDetail").style.display = "none";
        document.getElementById("errorMessage").textContent = message;
      }

      function displayCheatSheets(cheatSheets) {
        document.getElementById("loadingSection").style.display = "none";
        document.getElementById("errorSection").style.display = "none";
        document.getElementById("cheatSheetsSection").style.display = "block";
        document.getElementById("cheatSheetDetail").style.display = "none";

        const grid = document.getElementById("cheatSheetsGrid");
        grid.innerHTML = "";

        if (cheatSheets.length === 0) {
          grid.innerHTML = `
            <div class="empty-state" style="grid-column: 1 / -1;">
              <div class="empty-state-icon">ğŸ“„</div>
              <div>Ù‡ÛŒÚ† Ú†ÛŒØª Ø´ÛŒØªÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>
              ${
                authManager.isAuthenticated()
                  ? '<button class="auth-button primary" onclick="openModal(\'cheatSheetModal\')">Ø§ÛŒØ¬Ø§Ø¯ Ø§ÙˆÙ„ÛŒÙ† Ú†ÛŒØª Ø´ÛŒØª</button>'
                  : ""
              }
            </div>
          `;
          return;
        }

        cheatSheets.forEach((cheatSheet) => {
          const card = document.createElement("div");
          card.className = "cheat-sheet-card";
          card.onclick = () => showCheatSheetDetail(cheatSheet);

          const itemCount = cheatSheet.items ? cheatSheet.items.length : 0;
          const isOwner =
            authManager.isAuthenticated() &&
            authManager.getCurrentUser() &&
            cheatSheet.user_id === authManager.getCurrentUser().id;

          const ownerBadge = cheatSheet.is_public
            ? '<span class="badge public">Ø¹Ù…ÙˆÙ…ÛŒ</span>'
            : '<span class="badge private">Ø´Ø®ØµÛŒ</span>';

          card.innerHTML = `
            <div class="card-header">
              <div class="card-title">${escapeHtml(cheatSheet.title)}</div>
              ${ownerBadge}
            </div>
            <div class="card-description">${escapeHtml(
              cheatSheet.description || ""
            )}</div>
            <div class="card-meta">
              <span class="card-category">${escapeHtml(
                cheatSheet.category || "Ø¹Ù…ÙˆÙ…ÛŒ"
              )}</span>
              <span class="card-count">${itemCount} Ø¢ÛŒØªÙ…</span>
              ${
                cheatSheet.user
                  ? '<span class="card-author">ØªÙˆØ³Ø· ' +
                    escapeHtml(cheatSheet.user.name) +
                    "</span>"
                  : ""
              }
            </div>
            ${
              isOwner
                ? '<div class="card-actions"><button onclick="editCheatSheet(event, ' +
                  cheatSheet.id +
                  ')">ÙˆÛŒØ±Ø§ÛŒØ´</button><button onclick="deleteCheatSheet(event, ' +
                  cheatSheet.id +
                  ')">Ø­Ø°Ù</button></div>'
                : ""
            }
          `;

          grid.appendChild(card);
        });
      }

      function showCheatSheetDetail(cheatSheet) {
        document.getElementById("cheatSheetsSection").style.display = "none";
        document.getElementById("cheatSheetDetail").style.display = "block";

        document.getElementById("detailTitle").textContent = cheatSheet.title;
        document.getElementById("detailDescription").textContent =
          cheatSheet.description;

        const itemsContainer = document.getElementById("itemsContainer");
        itemsContainer.innerHTML = "";

        if (cheatSheet.items && cheatSheet.items.length > 0) {
          cheatSheet.items
            .sort((a, b) => a.order_index - b.order_index)
            .forEach((item) => {
              const itemCard = document.createElement("div");
              itemCard.className = "item-card";

              let codeHtml = "";
              if (item.code_example) {
                const safeCode = escapeHtml(item.code_example);
                codeHtml = `
                                <div class="code-block">
                                    <pre>${safeCode}</pre>
                                </div>
                            `;
              }

              itemCard.innerHTML = `
                            <button class="copy-btn" onclick="copyItemContent(event, '${escapeHtml(
                              item.title
                            )}', '${escapeHtml(item.content)}', '${
                item.code_example ? escapeHtml(item.code_example) : ""
              }')" title="Ú©Ù¾ÛŒ Ù…Ø­ØªÙˆØ§ÛŒ Ø¢ÛŒØªÙ…">ğŸ“‹</button>
                            <div class="item-title">${escapeHtml(
                              item.title
                            )}</div>
                            <div class="item-content">${escapeHtml(
                              item.content
                            )}</div>
                            ${codeHtml}
                        `;

              itemsContainer.appendChild(itemCard);
            });
        } else {
          itemsContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“„</div>
                        <div>Ù‡ÛŒÚ† Ø¢ÛŒØªÙ…ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ú†ÛŒØª Ø´ÛŒØª Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª.</div>
                    </div>
                `;
        }
      }

      function showCheatSheetsList() {
        document.getElementById("cheatSheetDetail").style.display = "none";
        document.getElementById("cheatSheetsSection").style.display = "block";
      }

      async function copyCheatSheetContent(event, cheatSheetId) {
        event.stopPropagation();

        try {
          const cheatSheet = await cheatSheetService.getCheatSheet(
            cheatSheetId
          );
          if (cheatSheet && cheatSheet.items) {
            let content = `${cheatSheet.title}\n`;
            content += `${
              cheatSheet.description ? cheatSheet.description + "\n" : ""
            }`;
            content += "=".repeat(50) + "\n\n";

            cheatSheet.items.forEach((item, index) => {
              content += `${index + 1}. ${item.title}\n`;
              if (item.description) {
                content += `   ${item.description}\n`;
              }
              if (item.code) {
                content += `   Ú©Ø¯: ${item.code}\n`;
              }
              content += "\n";
            });

            await navigator.clipboard.writeText(content);
            showMessage("Ù…Ø­ØªÙˆØ§ÛŒ Ú†ÛŒØªâ€ŒØ´ÛŒØª Ú©Ù¾ÛŒ Ø´Ø¯!", "success");
          }
        } catch (error) {
          console.error("Error copying cheat sheet:", error);
          showMessage("Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§", "error");
        }
      }

      async function copyItemContent(event, title, content, code) {
        event.stopPropagation();

        try {
          let itemContent = `${title}\n`;
          if (content) {
            itemContent += `${content}\n`;
          }
          if (code) {
            itemContent += `\nÚ©Ø¯:\n${code}\n`;
          }

          await navigator.clipboard.writeText(itemContent);
          showMessage("Ù…Ø­ØªÙˆØ§ÛŒ Ø¢ÛŒØªÙ… Ú©Ù¾ÛŒ Ø´Ø¯!", "success");
        } catch (error) {
          console.error("Error copying item:", error);
          showMessage("Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø¢ÛŒØªÙ…", "error");
        }
      }

      function escapeHtml(text) {
        if (!text) return "";
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Modal functions
      function openModal(modalId) {
        document.getElementById(modalId).style.display = "block";

        // Clear form errors
        const errorElements = document.querySelectorAll(".error-message");
        errorElements.forEach((el) => (el.style.display = "none"));

        // Reset cheat sheet form
        if (modalId === "cheatSheetModal") {
          document.getElementById("cheatSheetForm").reset();
          document.getElementById("cheatSheetModalTitle").textContent =
            "Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØª Ø´ÛŒØª Ø¬Ø¯ÛŒØ¯";
        }
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      // Handle create/edit cheat sheet
      async function handleCheatSheetSubmit(e) {
        e.preventDefault();

        const title = document.getElementById("cheatSheetTitle").value;
        const description = document.getElementById(
          "cheatSheetDescription"
        ).value;
        const category = document.getElementById("cheatSheetCategory").value;
        const isPublic = document.getElementById("cheatSheetPublic").checked;
        const errorDiv = document.getElementById("cheatSheetError");

        try {
          const cheatSheetData = {
            title,
            description,
            category,
            is_public: isPublic,
          };

          const result = await cheatSheetService.createCheatSheet(
            cheatSheetData
          );

          if (result.success) {
            closeModal("cheatSheetModal");
            showMessage("Ú†ÛŒØª Ø´ÛŒØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯!", "success");
            loadCheatSheets();
          } else {
            errorDiv.textContent = result.message;
            errorDiv.style.display = "block";
          }
        } catch (error) {
          errorDiv.textContent = "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú†ÛŒØª Ø´ÛŒØª: " + error.message;
          errorDiv.style.display = "block";
        }
      }

      // Edit cheat sheet
      async function editCheatSheet(event, id) {
        event.stopPropagation();

        try {
          const result = await cheatSheetService.getCheatSheet(id);

          if (result.success && result.data) {
            const cheatSheet = result.data;

            document.getElementById("cheatSheetTitle").value = cheatSheet.title;
            document.getElementById("cheatSheetDescription").value =
              cheatSheet.description || "";
            document.getElementById("cheatSheetCategory").value =
              cheatSheet.category || "";
            document.getElementById("cheatSheetPublic").checked =
              cheatSheet.is_public;
            document.getElementById("cheatSheetModalTitle").textContent =
              "ÙˆÛŒØ±Ø§ÛŒØ´ Ú†ÛŒØª Ø´ÛŒØª";

            openModal("cheatSheetModal");

            // Update form handler for editing
            const form = document.getElementById("cheatSheetForm");
            form.onsubmit = async function (e) {
              e.preventDefault();

              const title = document.getElementById("cheatSheetTitle").value;
              const description = document.getElementById(
                "cheatSheetDescription"
              ).value;
              const category =
                document.getElementById("cheatSheetCategory").value;
              const isPublic =
                document.getElementById("cheatSheetPublic").checked;
              const errorDiv = document.getElementById("cheatSheetError");

              try {
                const updateData = {
                  title,
                  description,
                  category,
                  is_public: isPublic,
                };

                const updateResult = await cheatSheetService.updateCheatSheet(
                  id,
                  updateData
                );

                if (updateResult.success) {
                  closeModal("cheatSheetModal");
                  showMessage("Ú†ÛŒØª Ø´ÛŒØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯!", "success");
                  loadCheatSheets();

                  // Reset form handler
                  form.onsubmit = handleCheatSheetSubmit;
                } else {
                  errorDiv.textContent = updateResult.message;
                  errorDiv.style.display = "block";
                }
              } catch (error) {
                errorDiv.textContent =
                  "Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú†ÛŒØª Ø´ÛŒØª: " + error.message;
                errorDiv.style.display = "block";
              }
            };
          }
        } catch (error) {
          showMessage(
            "Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú†ÛŒØª Ø´ÛŒØª: " + error.message,
            "error"
          );
        }
      }

      // Delete cheat sheet
      async function deleteCheatSheet(event, id) {
        event.stopPropagation();

        if (!confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú†ÛŒØª Ø´ÛŒØª Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ")) {
          return;
        }

        try {
          const result = await cheatSheetService.deleteCheatSheet(id);

          if (result.success) {
            showMessage("Ú†ÛŒØª Ø´ÛŒØª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯", "success");
            loadCheatSheets();
          } else {
            showMessage("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú†ÛŒØª Ø´ÛŒØª: " + result.message, "error");
          }
        } catch (error) {
          showMessage("Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ú†ÛŒØª Ø´ÛŒØª: " + error.message, "error");
        }
      }

      function showMessage(message, type = "info") {
        // Create a toast notification
        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;
        toast.textContent = message;

        const toastStyles = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${
            type === "success"
              ? "#28a745"
              : type === "error"
              ? "#dc3545"
              : "#007acc"
          };
          color: white;
          padding: 15px 20px;
          border-radius: 4px;
          z-index: 10000;
          max-width: 300px;
          word-wrap: break-word;
          animation: slideIn 0.3s ease-out;
        `;

        toast.style.cssText = toastStyles;
        document.body.appendChild(toast);

        // Add slide-in animation
        if (!document.getElementById("toast-styles")) {
          const style = document.createElement("style");
          style.id = "toast-styles";
          style.textContent = `
            @keyframes slideIn {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
          `;
          document.head.appendChild(style);
        }

        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 4000);
      }

      // Keyboard shortcuts
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          const detailSection = document.getElementById("cheatSheetDetail");
          if (detailSection.style.display === "block") {
            showCheatSheetsList();
          }

          // Close modals
          const modals = document.querySelectorAll(".modal");
          modals.forEach((modal) => {
            if (modal.style.display === "block") {
              modal.style.display = "none";
            }
          });
        }
      });

      // Load cheat sheets when page loads
      window.addEventListener("load", loadCheatSheets);
    </script>
  </body>
</html>
